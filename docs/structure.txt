┌──────────────────────────────────────────────────────────┐
│                      SOURCES                             │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────┐
│ DocumentExtractor (ABC)      │
│──────────────────────────────│
│ + extract(path)              │
│     -> DocumentExtractionResult
└───────────────┬──────────────┘
                │
        ┌───────┴─────────┐
        │                 │
┌──────────────────┐ ┌─────────────────────┐
│ Filesystem       │ │ Thunderbird          │
│ Extractor        │ │ Extractor            │
│──────────────────│ │─────────────────────│
│ extract()        │ │ extract()            │
└──────────────────┘ └─────────────────────┘


┌──────────────────────────────────────────────────────────┐
│                EXTRACTION RESULT                         │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ DocumentExtractionResult (Pydantic)          │
│──────────────────────────────────────────────│
│ parts: list[DocumentPart]                    │
│----------------------------------------------│
│ + is_multipart                               │
│ + single_part()                              │
└──────────────────────────────┬───────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────┐
│ DocumentPart (dataclass, frozen=True)        │
│──────────────────────────────────────────────│
│ text                                         │
│ unit_locator                                 │
│ content_type                                 │
│ extractor_name                               │
│ extractor_version                            │
│ metadata                                     │
└──────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────┐
│                     DOCUMENT                             │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────┐
│ Document (Pydantic)                          │
│──────────────────────────────────────────────│
│ id                                           │
│ source_type                                  │
│ source_id                                    │
│ device_id                                    │
│ source_path                                  │
│ parts: list[DocumentPart]                    │
│ checksum                                     │
│ metadata                                     │
│ created_at / updated_at                      │
│----------------------------------------------│
│ + to_dict()                                  │
└──────────────────────────────┬───────────────┘
                               │
                               ▼


┌──────────────────────────────────────────────────────────┐
│                     CHUNKING                             │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────┐
│ Chunker (ABC)                │
│──────────────────────────────│
│ + chunk(document, parts)     │
│     -> list[Chunk]           │
└───────────────┬──────────────┘
                │
        ┌───────┴──────────┐
        │                  │
┌────────────────────┐ ┌─────────────────────┐
│ SemanticChunker    │ │ RuleBasedChunker     │
│────────────────────│ │─────────────────────│
│ _chunk_single_part │ │ _chunk_single_part  │
└────────────────────┘ └─────────────────────┘


┌──────────────────────────────────────────────┐
│ Chunk (dataclass)                            │
│──────────────────────────────────────────────│
│ id                                           │
│ document_id                                  │
│ unit_locator                                 │
│ index                                        │
│ text                                         │
│ metadata                                     │
└──────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────┐
│                  EMBEDDINGS                              │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────┐
│ EmbeddingProvider (ABC)      │
│──────────────────────────────│
│ + embed(text)                │
│     -> EmbeddingOutput       │
└───────────────┬──────────────┘
                │
        ┌───────┴──────────┐
        │                  │
┌────────────────────┐ ┌─────────────────────┐
│ OpenAIEmbedding    │ │ BGE-M3Embedding      │
│ Provider           │ │ Provider             │
└────────────────────┘ └─────────────────────┘


┌──────────────────────────────────────────────┐
│ EmbeddingOutput (dataclass)                  │
│──────────────────────────────────────────────│
│ dense                                        │
│ sparse                                       │
│ colbert                                      │
└──────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────┐
│                 VECTOR STORAGE                           │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────┐
│ VectorStore (ABC)            │
│──────────────────────────────│
│ + add(chunk, embedding)      │
│ + search(query)              │
│ + remove_chunks(ids)         │
│ + clear()                    │
└───────────────┬──────────────┘
                │
┌──────────────────────────────────────────────┐
│ QdrantVectorStoreHybrid                      │
│──────────────────────────────────────────────│
│ dense + sparse + colbert                     │
│ payload = chunk metadata                    │
└──────────────────────────────────────────────┘

